datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
  engineType = "binary"
}

model User {
  id        String          @id @default(uuid())
  email     String          @unique
  name      String?
  providers Provider[]
  jobs      ConversionJob[]
  createdAt DateTime        @default(now())
}

model Provider {
  id             String     @id @default(uuid())
  provider       String
  providerUserId String
  accessToken    String?
  refreshToken   String?
  expiresAt      DateTime?
  user           User       @relation(fields: [userId], references: [id])
  userId         String
  createdAt      DateTime   @default(now())
    
  @@unique([provider, providerUserId])

}

model Session {
  sid     String   @id
  sess    Json
  expire  DateTime

  @@index([expire], name: "IDX_session_expire")
}

model ConversionJob {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id])
  
  data            Json?  
  status          String   @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED
  progress        Int      @default(0)
  result          String?  // The new playlist ID or error message
  resultData      Json?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}